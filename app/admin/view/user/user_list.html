<div class="search">
    <form class="form-inline">
        <input type="text" value="{$req['user_id']??''}" name="user_id" placeholder="搜索用户ID" class="form-control">
        <input type="text" value="{$req['up_user']??''}" name="up_user" placeholder="搜索上级用户ID/手机号"
               class="form-control">
        <input type="text" value="{$req['phone']??''}" name="phone" placeholder="搜索手机号" class="form-control">
        <input type="text" value="{$req['realname']??''}" name="realname" placeholder="搜索实名姓名" class="form-control">
        <input type="text" value="{$req['ic_number']??''}" name="ic_number" placeholder="搜索身份证号" class="form-control">
        <select name="level" class="form-control">
            <option value="">搜索等级</option>
            <?php foreach (config('map.user')['level_map'] as $k => $v) { ?>
                <option <?php if (isset($req['level']) && $req['level'] !== '' && $req['level'] == $k) {
                    echo 'selected = "selected"';
                } ?> value="{$k}">{$v}
                </option>
            <?php } ?>
        </select>
        <select name="is_active" class="form-control">
            <option value="">搜索是否激活</option>
            <option <?php if (isset($req['is_active']) && $req['is_active'] !== '' && $req['is_active'] == 0) {
                echo 'selected = "selected"';
            } ?> value="0">未激活
            </option>
            <option <?php if (isset($req['is_active']) && $req['is_active'] !== '' && $req['is_active'] == 1) {
                echo 'selected = "selected"';
            } ?> value="1">已激活
            </option>
        </select>

        <select name="is_hvps" class="form-control">
            <option value="">搜索开户</option>
            <option <?php if (isset($req['is_hvps']) && $req['is_hvps'] !== '' && $req['is_hvps'] == 0) {
                echo 'selected = "selected"';
            } ?> value="0">未开户
            </option>
            <option <?php if (isset($req['is_hvps']) && $req['is_hvps'] !== '' && $req['is_hvps'] == 1) {
                echo 'selected = "selected"';
            } ?> value="1">已开户
            </option>
            <option <?php if (isset($req['is_hvps']) && $req['is_hvps'] !== '' && $req['is_hvps'] == 2) {
                echo 'selected = "selected"';
            } ?> value="2">免费开户
            </option>
        </select>
        <input placeholder="开户开始时间" autocomplete="off" value="{$req['hvps_start_date']??''}" name="hvps_start_date" class="form-control layer-date" id="hvps_start_date">
        ～
        <input placeholder="开户结束时间" autocomplete="off" value="{$req['hvps_end_date']??''}" name="hvps_end_date" class="form-control layer-date" id="hvps_end_date">
        <input placeholder="开始时间" autocomplete="off" value="{$req['start_date']??''}" name="start_date" class="form-control layer-date" id="start">
        ～
        <input placeholder="结束时间" autocomplete="off" value="{$req['end_date']??''}" name="end_date" class="form-control layer-date" id="end">
        <input placeholder="激活时间" autocomplete="off" value="{$req['active_date']??''}" name="active_date" class="form-control layer-date" id="active_date">
        <input class="btn btn-flat btn-primary m_10" type="submit" value="搜索">
        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;共 {$count} 条记录</span>
    </form>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-body table-responsive no-padding">
                    <table class="table table-bordered table-hover table-striped">
                        <tbody>
                        <tr>
                            <th>ID</th>
                            <th>上级会员</th>
                            <th>手机号</th>
                            <th>余额</th>
                            <th>收益</th>
                            <!-- <th>生活补助</th> -->
                            <th>红包余额</th>
                            <th>团队奖励</th>
                            <th>月薪钱包</th>
                            <th>生育补贴</th>
                            <th>邀请码</th>
                            <th>实名</th>
                            <th>等级</th>
                            <th>身份证</th>
                            <th>激活</th>
                            <th>激活时间</th>
                            <th>直属下级实名</th>
                            <th>注册ip</th>
                            <th>登录ip</th>
                            <!-- <th>总投资</th> -->
                            <th>注册时间</th>
                            <th>最后登录</th>
                            <th>状态</th>
                            <!-- <th>首码</th> -->
                            <th>操作</th>
                        </tr>
                        <?php foreach ($data as $k => $v) { ?>
                            <tr>
                                <td>{$v['id']}</td>
                                <td>{$v['upUser']['phone']??''}</td>
                                <td>{$v['phone']}</td>
                                <td>{$v['topup_balance']}</td>
                                <td>{$v['income_balance']}</td>
                                <!-- <td>{$v['poverty_subsidy_amount']}</td> -->
                                <td>{$v['shenianhongbao']}</td>
                                <td>{$v['xuanchuan_balance']}</td>
                                <td>{$v['team_bonus_balance']}</td>
                                <td>{$v['shengyu_butie_balance']}</td>
                                <td>{$v['invite_code']}</td>
                                <td>{$v['realname']}</td>
                                <td>{$v['level_text']}</td>
                                <td>{$v['ic_number']}</td>
<!--                                 <td>{$v['ic_number']}</td>
                                <td>{$v['level_text']}</td>
 -->                                <td>{$v['is_active_text']}</td>
                                <td>{$v['active_date']}</td>
                                <td><a href="{:url('admin/User/userList', ['up_user' => $v['id'], 'is_realname' => 1])}">{$v['real_sub_user_num']}</a></td>
                                <!-- <td>{$v['invest_amount']}</td> -->
                                <td>{$v['register_ip']}</td>
                                <td>{$v['login_ip']}</td>
                                <td>{$v['created_at']}</td>
                                <td>{$v['last_login_time']}</td>
                                <td>
                                    <div class="switch">
                                        <div class="onoffswitch">
                                            <input type="checkbox" <?php echo $v['status'] == 1 ? 'checked' : ''; ?>
                                                   class="onoffswitch-checkbox" id="status{$v['id']}">
                                            <label class="onoffswitch-label" for="status{$v['id']}"
                                                   onclick="changeUser({$v['id']}, 'status')">
                                                <span class="onoffswitch-inner"></span>
                                                <span class="onoffswitch-switch"></span>
                                            </label>
                                        </div>
                                    </div>
                                </td>
                                <!-- <td>
                                    <div class="switch">
                                        <div class="onoffswitch">
                                            <input type="checkbox" <?php echo $v['is_agent'] == 1 ? 'checked' : ''; ?>
                                                   class="onoffswitch-checkbox" id="is_agent{$v['id']}">
                                            <label class="onoffswitch-label" for="is_agent{$v['id']}"
                                                   onclick="changeUser({$v['id']}, 'is_agent')">
                                                <span class="onoffswitch-inner"></span>
                                                <span class="onoffswitch-switch"></span>
                                            </label>
                                        </div>
                                    </div>
                                </td> -->
                                <td>

                                    <a {:auth_show_judge('User/editUser')} class="btn btn-flat btn-xs" href="{:url('admin/User/showUser', ['id' => $v['id']])}">编辑用户</a>
                                    <a {:auth_show_judge('User/addBalance')} class="btn btn-flat btn-xs" href="{:url('admin/User/showChangeBalance', ['user_id' => $v['id'], 'type' => 15])}">手动入金</a>
<!--                                    <a {:auth_show_judge('User/addOrder')} class="btn btn-flat btn-xs" href="{:url('admin/User/showChangeOrder', ['user_id' => $v['id'], 'type' => 15])}">赠送产品</a>-->
<!--                                    <a {:auth_show_judge('User/addJiaoNa')} class="btn btn-flat btn-xs" href="{:url('admin/User/showChangeJiaoNa', ['user_id' => $v['id']])}">赠送缴纳</a>-->
<!--                                    <a {:auth_show_judge('User/batchBalance')} class="btn btn-flat btn-xs" href="{:url('admin/User/batchShowBalance', ['user_id' => $v['id'], 'type' => 15])}">批量入金</a>-->
                                    <!-- <a {:auth_show_judge('User/deductBalance')} class="btn btn-flat btn-xs" href="{:url('admin/User/showChangeBalance', ['user_id' => $v['id'], 'type' => 16])}">手动出金</a> -->
                                    <a {:auth_show_judge('User/userTeamList')} class="btn btn-flat btn-xs" href="{:url('admin/User/userTeamList', ['user_id' => $v['id']])}">查看团队人数</a>
                                    {if $v['has_subsidy'] }
                                    <a {:auth_show_judge('Zhengce/editZhengce')} class="btn btn-flat btn-xs" href="{:url('admin/Zhengce/showZhengce', ['id' => $v['id']])}">政策修改</a>
                                    {/if}
                                     <a {:auth_show_judge('UserDelivery/userDeliveryList')} class="btn btn-flat btn-xs" href="{:url('admin/UserDelivery/userDeliveryList', ['user_id' => $v['id']])}">查看收货地址</a>
                                    <!--<a {:auth_show_judge('PayAccount/payAccountList')} class="btn btn-flat btn-xs" href="{:url('admin/PayAccount/payAccountList', ['user_id' => $v['id']])}">查看收款配置</a> -->
                                    <a {:auth_show_judge('User/editPhone')} class="btn btn-flat btn-xs" href="{:url('admin/User/editPhone', ['user_id' => $v['id']])}">修改手机号</a>
<!--                                    <a {:auth_show_judge('User/editPhone')} class="btn btn-flat btn-xs" href="{:url('admin/User/editRelease', ['user_id' => $v['id']])}">修改释放提现额度</a>-->
                                    <a {:auth_show_judge('User/bankList')} class="btn btn-flat btn-xs" href="{:url('admin/User/bankList', ['user_id' => $v['id']])}">银行卡列表</a>
<!--                                    <a {:auth_show_judge('User/openAuth')} class="btn btn-flat btn-xs" href="{:url('admin/User/openAuth', ['user_id' => $v['id']])}">开户认证</a>-->
<!--                                    <a {:auth_show_judge('User/homelandList')} class="btn btn-flat btn-xs" href="{:url('admin/User/homelandList', ['user_id' => $v['id']])}">户口认证</a>-->
<!--                                    <a {:auth_show_judge('User/reserveHouse')} class="btn btn-flat btn-xs" href="{:url('admin/User/reserveHouse', ['user_id' => $v['id']])}">预约看房</a>-->
<!--                                    <a {:auth_show_judge('User/reserveCar')} class="btn btn-flat btn-xs" href="{:url('admin/User/reserveCar', ['user_id' => $v['id']])}">预约看车</a>-->
<!--                                    <a {:auth_show_judge('User/userNums')} class="btn btn-flat btn-xs" href="{:url('admin/User/userNums', ['user_id' => $v['id']])}">产品/人数</a>-->
<!--                                    <a {:auth_show_judge('User/userNums')} class="btn btn-flat btn-xs" href="{:url('admin/User/jiaoNaNums', ['user_id' => $v['id']])}">缴纳人数</a>-->
<!--                                    <a {:auth_show_judge('User/homeland')} class="btn btn-flat btn-xs" href="{:url('admin/User/wallet', ['user_id' => $v['id']])}">收货地址</a>-->
                                    <!-- <a {:auth_show_judge('User/editBank')} class="btn btn-flat btn-xs" href="{:url('admin/User/editBank', ['user_id' => $v['id']])}">修改银行卡</a> -->
                                    <!-- <a {:auth_show_judge('User/message')} class="btn btn-flat btn-xs" href="{:url('admin/User/message', ['user_id' => $v['id']])}">发送站内信</a> -->
                                </td>
                            </tr>
                        <?php } ?>
                        </tbody>
                    </table>
                </div>
                <div style="text-align:center;font-size: 14px;"><?php echo $data->render(); ?></div>
            </div>
        </div>
    </div>
</div>

<script>
        $(function () {
        //日期范围限制
        var hvps_start_date = {
            elem: '#hvps_start_date',
            format: 'yyyy-MM-dd',
        };
        var hvps_end_date = {
            elem: '#hvps_end_date',
            format: 'yyyy-MM-dd',
        };
        var start = {
            elem: '#start',
            format: 'yyyy-MM-dd',
        };
        var end = {
            elem: '#end',
            format: 'yyyy-MM-dd',
        };
        var active_date = {
            elem: '#active_date',
            format: 'yyyy-MM-dd',
        };
            laydate.render(hvps_start_date);
            laydate.render(hvps_end_date);
        laydate.render(start);
        laydate.render(end);
        laydate.render(active_date);
    });
    function changeUser(id, field)
    {
        var value = 0;
        if ($('#' + field + id).is(':checked')) {
            value = 0;
        } else {
            value = 1;
        }

        //确认框
        layer.confirm('确定操作吗', {icon: 3, title: '提示'}, function (index) {
            layer.close(index);
            $.post('{:url("admin/User/changeUser")}', {"id": id, "value": value, "field": field}, function (res) {
                if (res.code != 200) {
                    if (value == 1) {
                        $('#' + field + id).prop('checked', false);
                    } else {
                        $('#' + field + id).prop('checked', true);
                    }
                    layer.msg(res.msg, {icon: 5, time: 2500, offset: '80px'});
                }
            });
        }, function (index2) {
            if (value == 1) {
                $('#' + field + id).prop('checked', false);
            } else {
                $('#' + field + id).prop('checked', true);
            }
        });
    }
</script>
<style>
    th{
        font-size: 14px;
    }
</style>
